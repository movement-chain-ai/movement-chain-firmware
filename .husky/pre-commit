#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "üîç Running pre-commit checks for firmware..."

# Check for common C++ mistakes
echo "Checking for common issues..."
if grep -rn "Serial.print\|printf\|cout" src/ 2>/dev/null; then
  echo "‚ö†Ô∏è  Warning: Debug print statements found (non-blocking)"
fi

# Check for TODO comments
if grep -rn "TODO\|FIXME" src/ lib/ 2>/dev/null | head -5; then
  echo "‚ö†Ô∏è  Warning: TODO/FIXME comments found (non-blocking)"
fi

# Format C++ code if clang-format is installed
if command -v clang-format > /dev/null; then
  echo "Formatting C++ files..."
  find src/ lib/ -name "*.cpp" -o -name "*.h" -o -name "*.ino" 2>/dev/null | xargs clang-format -i --style=Google || true
else
  echo "‚ö†Ô∏è  clang-format not installed, skipping formatting"
fi

echo "‚úÖ Pre-commit checks completed"
